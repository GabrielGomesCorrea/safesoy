<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/SuperUsuario.css">
</head>

<body onload="atualizarFeedFazenda(), atualizarFeedFuncionarios()">

    <!-- Header -->
    <div class="background">
        <header class="menu">
            <div class="navbar">
                <div class="espaco"></div>
                <img onclick="home()" src="src/img/Logo.svg" alt="" class="logo">
                <img src="src/img/vector.svg" alt="" class="user">
            </div>
        </header>
        <div class="mensagem">
            <div class="bloco1">
                <h1 class="msg">Seja bem vindo de volta, <span id="nome_user"></span>!</h1>
                <h3 class="texto">O que deseja fazer hoje?</h3>
                <button>Acessar a dashboard</button>
            </div>
        </div>
    </div>

    <div class="paipainel" id="painel_pai"></div>

    <div class="paipainel2" id="paipainel2">
        <div class="painel2" id="painelfilho2">
            <div class="titulospainel2">
                <h1>Nome</h1>
                <h1>Editar</h1>
            </div>
            <div class="conteudopainel2" id="conteudopainel_2">
            </div>
        </div>
    </div>


    <div class="footer">
        <h1 class="titulo"><b>Problemas com os sensores?</b></h1>
        <h2 class="titulo2">Acesse o nosso suporte de inteligÃªncia artificial!</h2>
        <button onclick="suporte()">Clique aqui</button>
    </div>

</body>

</html>

<script>
    function atualizarFeedFazenda() {

        nome_user.innerHTML = sessionStorage.NOME_USUARIO;
        fetch("/superUsuario/listarFazenda").then(function (resposta) {
            if (resposta.ok) {
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    // quando tiver o login, tem que comparar os valores da sessionStorage
                    let nome = "joao"
                    let rf = '1'
                    let fkFazenda = "2"
                    let fkSuperUsuario = "null"

                    sessionStorage.setItem("nome", nome)
                    sessionStorage.setItem("rf", rf)
                    sessionStorage.setItem("fkFazenda", fkFazenda)
                    sessionStorage.setItem("fkSuperUsuario", fkSuperUsuario)

                    var painelPai = document.getElementById("painel_pai");
                    var painelFilho = document.createElement("div");
                    var tituloPainel = document.createElement("div");
                    var conteudoPainel = document.createElement("div");

                    for (let i = 0; i < resposta.length; i++) {
                        if (resposta[i].idFazenda == sessionStorage.getItem("fkFazenda")) {
                            var respostasBD = resposta[i];
                            break
                        }

                    }

                    if (respostasBD) {
                        var tituloDoPainel = document.createElement("h1")
                        var qtdPainel = document.createElement("h1")
                        var tipoFunc = document.createElement("h1")

                        tituloDoPainel.innerHTML = respostasBD.nome;
                        qtdPainel.innerHTML = respostasBD.QtdFunc;
                        tipoFunc.innerHTML = "Funcionarios";

                        painelPai.className = "paiPainel";
                        painelFilho.className = "painel";
                        tituloPainel.className = "titulopainel";
                        conteudoPainel.className = "conteudopainel";
                        tituloDoPainel.className = "h1";
                        qtdPainel.className = "funcionario";
                        tipoFunc.className = "funcionario";

                        painelPai.appendChild(painelFilho)
                        painelFilho.appendChild(tituloPainel)
                        tituloPainel.appendChild(tituloDoPainel)
                        painelFilho.appendChild(conteudoPainel)
                        conteudoPainel.appendChild(qtdPainel)
                        conteudoPainel.appendChild(tipoFunc)
                    }
                    else {
                        alert(`Houve um erro ao buscar a fazenda`)
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }

    var rfFunc = sessionStorage.getItem("rf")

    function atualizarFeedFuncionarios() {
        fetch(`/superUsuario/listarFuncionario/${rfFunc}`).then(function (resposta) {
            if (resposta.ok) {
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var painelPai2 = document.getElementById("paipainel2");
                    var painelfilho2 = document.getElementById("painelfilho2")
                    var conteudopainel2 = document.getElementById("conteudopainel_2");

                    for (var index = 0; index < resposta.length; index++) {
                        var resultadoBD = resposta[index]
                        var pessoa = document.createElement("div")
                        var infoFunc = document.createElement("div")
                        var nomeFunc = document.createElement("h1")
                        var rfFunc = document.createElement("h1")
                        var divBotao = document.createElement("div")
                        var botaoDots = document.createElement("button")

                        nomeFunc.innerHTML = resultadoBD.nome;
                        rfFunc.innerHTML = resultadoBD.rf;
                        botaoDots.innerHTML = "Deletar Usuario"


                        painelPai2.className = "paiPainel2";
                        painelfilho2.className = "painel2";
                        conteudopainel2.className = "conteudopainel2";
                        pessoa.className = "pessoa";
                        infoFunc.className = "nome";
                        divBotao.className = "dots";


                        painelPai2.appendChild(painelfilho2)
                        painelfilho2.appendChild(conteudopainel2)
                        conteudopainel2.appendChild(pessoa)
                        pessoa.appendChild(infoFunc)
                        infoFunc.appendChild(nomeFunc)
                        infoFunc.appendChild(rfFunc)
                        pessoa.appendChild(divBotao)
                        divBotao.appendChild(botaoDots)
                        
                    }

                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }
</script>